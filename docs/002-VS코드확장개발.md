# 002-VS코드확장개발.md

## VS Code Extension 개발 가이드

### 프로젝트 구조
```
src/extension/
├── package.json              # 확장 매니페스트
├── src/
│   ├── extension.ts         # 메인 엔트리 포인트
│   ├── auth/
│   │   ├── authProvider.ts  # 인증 관리
│   │   └── tokenManager.ts  # 토큰 관리
│   ├── sync/
│   │   ├── syncEngine.ts    # 동기화 엔진
│   │   ├── configManager.ts # 설정 관리
│   │   └── conflictResolver.ts # 충돌 해결
│   ├── ui/
│   │   ├── commands.ts      # 명령어 등록
│   │   ├── statusBar.ts     # 상태바 UI
│   │   └── webview.ts       # 웹뷰 패널
│   └── utils/
│       ├── logger.ts        # 로깅
│       └── storage.ts       # 로컬 저장소
└── resources/
    ├── icons/               # 아이콘 리소스
    └── webview/            # 웹뷰 HTML/CSS
```

### 핵심 기능 구현

#### 1. 확장 활성화 및 초기화
```typescript
// src/extension.ts
import * as vscode from 'vscode';
import { AuthProvider } from './auth/authProvider';
import { SyncEngine } from './sync/syncEngine';
import { registerCommands } from './ui/commands';

export async function activate(context: vscode.ExtensionContext) {
    const authProvider = new AuthProvider(context);
    const syncEngine = new SyncEngine(context, authProvider);
    
    // 명령어 등록
    registerCommands(context, authProvider, syncEngine);
    
    // 상태바 아이템 생성
    const statusBarItem = vscode.window.createStatusBarItem(
        vscode.StatusBarAlignment.Right, 100
    );
    statusBarItem.text = "$(sync) TeamSync";
    statusBarItem.command = 'teamsync.showPanel';
    statusBarItem.show();
    
    // 자동 동기화 설정
    if (authProvider.isAuthenticated()) {
        await syncEngine.startAutoSync();
    }
}
```

#### 2. 인증 시스템
```typescript
// src/auth/authProvider.ts
export class AuthProvider {
    private context: vscode.ExtensionContext;
    private tokenManager: TokenManager;
    
    constructor(context: vscode.ExtensionContext) {
        this.context = context;
        this.tokenManager = new TokenManager(context);
    }
    
    async login(): Promise<boolean> {
        try {
            // OAuth 2.0 Device Flow 시작
            const deviceCode = await this.requestDeviceCode();
            
            // 사용자에게 인증 URL 표시
            const authUrl = `https://teamsync.dev/auth/device?code=${deviceCode.userCode}`;
            await vscode.env.openExternal(vscode.Uri.parse(authUrl));
            
            // 토큰 폴링
            const tokens = await this.pollForTokens(deviceCode.deviceCode);
            await this.tokenManager.saveTokens(tokens);
            
            vscode.window.showInformationMessage('TeamSync 로그인 성공!');
            return true;
        } catch (error) {
            vscode.window.showErrorMessage(`로그인 실패: ${error.message}`);
            return false;
        }
    }
    
    private async requestDeviceCode(): Promise<DeviceCodeResponse> {
        const response = await fetch('https://api.teamsync.dev/auth/device', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ client_id: 'vscode-extension' })
        });
        return response.json();
    }
}
```

#### 3. 설정 동기화 엔진
```typescript
// src/sync/syncEngine.ts
export class SyncEngine {
    private configManager: ConfigManager;
    private conflictResolver: ConflictResolver;
    
    async syncToRemote(): Promise<void> {
        const localConfig = await this.configManager.getLocalConfig();
        const remoteConfig = await this.configManager.getRemoteConfig();
        
        if (this.hasConflicts(localConfig, remoteConfig)) {
            const resolution = await this.conflictResolver.resolve(
                localConfig, remoteConfig
            );
            await this.applyResolution(resolution);
        } else {
            await this.configManager.uploadConfig(localConfig);
        }
    }
    
    async syncFromRemote(): Promise<void> {
        const remoteConfig = await this.configManager.getRemoteConfig();
        await this.configManager.applyConfig(remoteConfig);
        
        vscode.window.showInformationMessage(
            '설정이 성공적으로 동기화되었습니다.'
        );
    }
}
```

### TODO 리스트

#### Phase 1: 기본 구조 (완료 예정: 2시간)
- [ ] VS Code 확장 프로젝트 스캐폴딩
- [ ] package.json 매니페스트 설정
- [ ] 기본 명령어 등록 (login, sync, logout)
- [ ] 상태바 UI 구현

#### Phase 2: 인증 시스템 (완료 예정: 3시간)
- [ ] OAuth 2.0 Device Flow 구현
- [ ] JWT 토큰 관리 시스템
- [ ] 토큰 갱신 로직
- [ ] 로그아웃 기능

#### Phase 3: 설정 관리 (완료 예정: 4시간)
- [ ] VS Code 설정 파일 읽기/쓰기
- [ ] 확장 목록 관리
- [ ] 키바인딩 동기화
- [ ] 스니펫 관리

#### Phase 4: 동기화 엔진 (완료 예정: 5시간)
- [ ] 로컬 ↔ 원격 동기화
- [ ] 충돌 감지 및 해결
- [ ] 자동 동기화 스케줄링
- [ ] 동기화 상태 표시

#### Phase 5: UI/UX 개선 (완료 예정: 2시간)
- [ ] 웹뷰 패널 구현
- [ ] 설정 미리보기
- [ ] 진행 상태 표시
- [ ] 에러 처리 및 알림
